<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Clac.UI.ViewModels"
             x:Class="Clac.UI.Views.InputView"
             x:DataType="vm:CalculatorViewModel">
    
    <UserControl.Styles>
        <Style Selector="TextBox.input-box">
            <Setter Property="FontFamily" Value="Courier New, monospace"/>
            <Setter Property="FontSize" Value="20"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="Background" Value="#e6e6e6"/>
            <Setter Property="Foreground" Value="Black"/>
            <Setter Property="CornerRadius" Value="0"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="BorderBrush" Value="Gray"/>
        </Style>
        <Style Selector="TextBox.input-box:focus /template/ Border#PART_BorderElement">
            <Setter Property="Background" Value="#e6e6e6"/>
            <Setter Property="BorderBrush" Value="Gray"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="CornerRadius" Value="0"/>
        </Style>
        <Style Selector="TextBox.input-box:pointerover /template/ Border#PART_BorderElement">
            <Setter Property="Background" Value="#e6e6e6"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="CornerRadius" Value="0"/>
        </Style>
        <!-- Error state styles -->
        <Style Selector="TextBox.input-box:error /template/ Border#PART_BorderElement">
            <Setter Property="BorderBrush" Value="Red"/>
            <Setter Property="BorderThickness" Value="2"/>
        </Style>
        <Style Selector="TextBox.input-box:error:focus /template/ Border#PART_BorderElement">
            <Setter Property="BorderBrush" Value="Red"/>
            <Setter Property="BorderThickness" Value="2"/>
        </Style>
        <Style Selector="TextBox.input-box /template/ TextBlock#PART_Watermark">
            <Setter Property="Foreground" Value="Black"/>
            <Setter Property="FontWeight" Value="Normal"/>
            <Setter Property="Opacity" Value="1.0"/>
        </Style>
        <Style Selector="TextBox.input-box:pointerover /template/ TextBlock#PART_Watermark">
            <Setter Property="Foreground" Value="#666666"/>
            <Setter Property="FontWeight" Value="Normal"/>
        </Style>
        <Style Selector="TextBox.input-box:focus /template/ TextBlock#PART_Watermark">
            <Setter Property="Foreground" Value="Black"/>
            <Setter Property="FontWeight" Value="Normal"/>
        </Style>
        <!-- Custom DataValidationErrors template -->
        <Style Selector="DataValidationErrors">
            <Setter Property="Template">
                <ControlTemplate>
                    <DockPanel LastChildFill="True">
                        <Border DockPanel.Dock="Bottom"
                                BorderBrush="Gray"
                                BorderThickness="2,0,2,0"
                                Background="White"
                                IsVisible="{Binding (DataValidationErrors.HasErrors)}">
                            <ContentControl ContentTemplate="{TemplateBinding ErrorTemplate}"
                                            DataContext="{TemplateBinding Owner}"
                                            Content="{Binding (DataValidationErrors.Errors)}"
                                            Margin="5,0,0,0"/>
                        </Border>
                        <ContentPresenter Name="PART_ContentPresenter"
                                          Background="{TemplateBinding Background}"
                                          BorderBrush="{TemplateBinding BorderBrush}"
                                          BorderThickness="{TemplateBinding BorderThickness}"
                                          CornerRadius="{TemplateBinding CornerRadius}"
                                          ContentTemplate="{TemplateBinding ContentTemplate}"
                                          Content="{TemplateBinding Content}"
                                          Padding="{TemplateBinding Padding}"/>
                    </DockPanel>
                </ControlTemplate>
            </Setter>
            <Setter Property="ErrorTemplate">
                <DataTemplate>
                    <ItemsControl ItemsSource="{Binding}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" Foreground="Red"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </DataTemplate>
            </Setter>
        </Style>
    </UserControl.Styles>
    
    <StackPanel Background="White">
        <!-- Input box with DataValidation -->
        <DataValidationErrors>
            <TextBox Classes="input-box"
                     Text="{Binding CurrentInput}"
                     Watermark="Enter number or operator"
                     KeyDown="OnInputKeyDown"/>
        </DataValidationErrors>
    </StackPanel>
</UserControl>